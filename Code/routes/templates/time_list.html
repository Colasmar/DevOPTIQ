{% include "header_buttons.html" %}
<link rel="stylesheet" href="./../../../static/time.css">
<script src="./../../../static/js/time.js"></script>

<h1>Gestion des analyses de temps</h1>

<button id="addAnalysisBtn" class="btn-primary">Ajouter une analyse de temps</button>

<div id="analysisModal" class="modal hidden">
  <div class="modal-content">
    <span class="close-btn" id="closeModal">&times;</span>
    <div id="analysisFormContainer">
      {% include "time_form.html" %}
    </div>
  </div>
</div>

<!-- TABLEAU : Activités -->
<h2>Analyses par activité</h2>
<table class="styled-table table-activity">
  <thead>
    <tr>
      <th>ID</th>
      <th>Type</th>
      <th>Activité</th>
      <th>Durée</th>
      <th>Récurrence</th>
      <th>Fréquence</th>
      <th>Personnes</th>
      <th>Temps annuel</th>
      <th>Délai</th>
      <th>Impact</th>
      <th>Retard</th>
      <th>% Retard</th>
    </tr>
  </thead>
  <tbody>
    {% for t in analyses if t.type == 'activity' %}
    <tr>
      <td>{{ t.id }}</td>
      <td>{{ t.type }}</td>
      <td>{{ t.activity.name if t.activity else '' }}</td>
      <td>{{ t.duration }} min</td>
      <td>{{ t.recurrence }}</td>
      <td>{{ t.frequency }}</td>
      <td>{{ t.nb_people }}</td>
      <td>{{ "%.1f"|format(t.annual_time / 60) }} h</td>
      <td>{{ t.delay or 0 }}</td>
      <td>{{ t.delay_increase or 0 }} {{ t.impact_unit or '' }}</td>
      <td class="{% if t.delay_gap >= 120 %}retard-rouge{% elif t.delay_gap >= 60 %}retard-orange{% else %}retard-vert{% endif %}">
        {{ t.delay_gap }} min
      </td>
      <td>
        {% if t.delay and t.delay_increase %}
          {{ "%.1f"|format((t.delay_increase / t.delay) * 100) }}%
        {% else %}
          -
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- TABLEAU : Rôles -->
<h2>Analyses par rôle</h2>
<table class="styled-table table-role">
  <thead>
    <tr>
      <th>ID</th>
      <th>Type</th>
      <th>Rôle</th>
      <th>Durée</th>
      <th>Récurrence</th>
      <th>Fréquence</th>
      <th>Personnes</th>
      <th>Temps annuel</th>
      <th>Délai</th>
      <th>Impact</th>
      <th>Retard</th>
      <th>% Retard</th>
    </tr>
  </thead>
  <tbody>
    {% for t in analyses if t.type == 'role' %}
    <tr>
      <td>{{ t.id }}</td>
      <td>{{ t.type }}</td>
      <td>{{ t.role.name if t.role else '' }}</td>
      <td>{{ t.duration }} min</td>
      <td>{{ t.recurrence }}</td>
      <td>{{ t.frequency }}</td>
      <td>{{ t.nb_people }}</td>
      <td>{{ "%.1f"|format(t.annual_time / 60) }} h</td>
      <td>{{ t.delay or 0 }}</td>
      <td>{{ t.delay_increase or 0 }} {{ t.impact_unit or '' }}</td>
      <td class="{% if t.delay_gap >= 120 %}retard-rouge{% elif t.delay_gap >= 60 %}retard-orange{% else %}retard-vert{% endif %}">
        {{ t.delay_gap }} min
      </td>
      <td>
        {% if t.delay and t.delay_increase %}
          {{ "%.1f"|format((t.delay_increase / t.delay) * 100) }}%
        {% else %}
          -
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- TABLEAU : Utilisateurs -->
<h2>Analyses par utilisateur</h2>
<table class="styled-table table-user">
  <thead>
    <tr>
      <th>ID</th>
      <th>Type</th>
      <th>Utilisateur</th>
      <th>Durée</th>
      <th>Récurrence</th>
      <th>Fréquence</th>
      <th>Personnes</th>
      <th>Temps annuel</th>
      <th>Délai</th>
      <th>Impact</th>
      <th>Retard</th>
      <th>% Retard</th>
    </tr>
  </thead>
  <tbody>
    {% for t in analyses if t.type == 'user' %}
    <tr>
      <td>{{ t.id }}</td>
      <td>{{ t.type }}</td>
      <td>{% if t.user %}{{ t.user.first_name }} {{ t.user.last_name }}{% endif %}</td>
      <td>{{ t.duration }} min</td>
      <td>{{ t.recurrence }}</td>
      <td>{{ t.frequency }}</td>
      <td>{{ t.nb_people }}</td>
      <td>{{ "%.1f"|format(t.annual_time / 60) }} h</td>
      <td>{{ t.delay or 0 }}</td>
      <td>{{ t.delay_increase or 0 }} {{ t.impact_unit or '' }}</td>
      <td class="{% if t.delay_gap >= 120 %}retard-rouge{% elif t.delay_gap >= 60 %}retard-orange{% else %}retard-vert{% endif %}">
        {{ t.delay_gap }} min
      </td>
      <td>
        {% if t.delay and t.delay_increase %}
          {{ "%.1f"|format((t.delay_increase / t.delay) * 100) }}%
        {% else %}
          -
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>