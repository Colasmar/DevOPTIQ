<h2>Nouvelle analyse de temps</h2>
<form id="timeAnalysisForm" method="post" action="{{ url_for('time_view.time_new') }}">
    <label>Type d'analyse :</label>
    <select id="analysisType" name="analysis_type" required>
        <option value="">--Sélectionner--</option>
        <option value="activity">Activité</option>
        <option value="task">Tâche</option>
        <option value="défaillance">Défaillance</option>
    </select><br><br>

    <div id="activitySelectContainer" class="hidden">
        <label>Activité :</label>
        <select name="activity_id">
            {% for a in activities %}
            <option value="{{ a.id }}">{{ a.name }}</option>
            {% endfor %}
        </select><br><br>
    </div>

    <div id="taskSelectContainer" class="hidden">
        <label>Tâche :</label>
        <select name="task_id">
            {% for t in tasks %}
            <option value="{{ t.id }}">{{ t.name }}</option>
            {% endfor %}
        </select><br><br>
    </div>

    <label>Récurrence :</label>
    <select name="recurrence" required>
        <option value="journalier">Journalier</option>
        <option value="hebdo">Hebdomadaire</option>
        <option value="mensuel">Mensuel</option>
        <option value="annuel">Annuel</option>
    </select><br><br>

    <label>Nombre de fois / récurrence :</label>
    <input type="number" name="frequency" required><br><br>

    <label>Durée (minutes):</label>
    <input type="number" name="duration" required><br><br>

    <label>Nombre de personnes impliquées :</label>
    <input type="number" name="nb_people" value="1" min="1" required><br><br>

    <!-- CHAMP RETARD (masqué sauf pour défaillance) -->
    <div id="delaySection" class="hidden">
        <label>Unité du délai :</label>
        <select name="delay_unit">
            <option value="">-- Aucun --</option>
            <option value="minutes">minutes</option>
            <option value="heures">heures</option>
            <option value="jours">jours</option>
            <option value="semaines">semaines</option>
            <option value="mois">mois</option>
        </select><br><br>

        <label>Retard (valeur supplémentaire) :</label>
        <input type="number" step="0.01" name="delay_increase"><br><br>
    </div>

    <button type="submit" class="btn-success">Enregistrer</button>
    <button type="button" id="cancelBtn" class="btn-secondary">Annuler</button>
</form>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const typeSelect = document.getElementById('analysisType');
    const delaySection = document.getElementById('delaySection');
    const activityContainer = document.getElementById('activitySelectContainer');
    const taskContainer = document.getElementById('taskSelectContainer');

    typeSelect.addEventListener('change', function () {
        const type = this.value;
        delaySection.classList.toggle('hidden', type !== 'défaillance');
        activityContainer.classList.toggle('hidden', type !== 'activity' && type !== 'défaillance');
        taskContainer.classList.toggle('hidden', type !== 'task');
    });
});
</script>
