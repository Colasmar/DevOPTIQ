<!-- Code/routes/templates/translate_softskills_modal.html -->

<div id="translateSoftskillsModal" style="display:none; position:fixed; left:20%; top:20%; width:60%; background:#fff; border:1px solid #aaa; padding:10px; z-index:9999;">
  <h4>Traduire Softskills</h4>
  <p>Entrez ci-dessous ce que vous considérez comme soft skills :</p>
  <textarea id="translateSoftskillsInput" style="width:100%; height:100px;"></textarea>
  <div style="margin-top:10px;">
    <button onclick="submitSoftskillsTranslation()">Valider</button>
    <button onclick="closeTranslateSoftskillsModal()">Annuler</button>
  </div>
</div>

<script>
function openTranslateSoftskillsModal(activityId) {
  window.translateSoftskillsActivityId = activityId;
  document.getElementById('translateSoftskillsModal').style.display = 'block';
}

function closeTranslateSoftskillsModal() {
  document.getElementById('translateSoftskillsModal').style.display = 'none';
  window.translateSoftskillsActivityId = null;
}

function submitSoftskillsTranslation() {
  let activityId = window.translateSoftskillsActivityId;
  if (!activityId) {
    alert("Identifiant de l'activité introuvable.");
    return;
  }
  let userInputElem = document.getElementById('translateSoftskillsInput');
  let userInput = userInputElem.value.trim();
  if (!userInput) {
    alert("Veuillez saisir du texte.");
    return;
  }
  fetch('/softskills/translate', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ user_input: userInput })
  })
  .then(res => res.json())
  .then(data => {
    if (data.error) {
      alert(data.error);
      return;
    }
    // data.proposals => tableau d'objets { habilete, niveau }
    data.proposals.forEach(item => {
      // On insère directement dans le DOM, comme proposeSoftskills
      addSoftskillItemToDOM(activityId, item.habilete, item.niveau);
    });
    userInputElem.value = "";
    closeTranslateSoftskillsModal();
  })
  .catch(err => {
    alert("Erreur lors de la traduction des softskills.");
    console.error(err);
  });
}
</script>
