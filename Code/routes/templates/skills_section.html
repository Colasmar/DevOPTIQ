<script>
  function fetchActivityDetailsForSkills(activityId) {
    // Afficher le spinner avant la requête
    showSpinner();
    fetch(`/activities/${activityId}/details`)
      .then(response => {
        if (!response.ok) {
          hideSpinner();
        }
        return response.json();
      })
      .then(data => {
        hideSpinner();
        if (data.error) {
          alert("Erreur : " + data.error);
          return;
        }
        proposeSkills(data);
      })
      .catch(error => {
        hideSpinner();
        alert("Erreur lors de la récupération des données : " + error.message);
      });
  }
  
  function proposeSkills(activityData) {
    // Afficher le spinner avant la requête
    showSpinner();
    fetch('/skills/propose', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(activityData)
    })
    .then(response => {
      if (!response.ok) {
        hideSpinner();
      }
      return response.json();
    })
    .then(data => {
      hideSpinner();
      if (data.error) {
        alert("Erreur dans la proposition: " + data.error);
        return;
      }
      // data.proposals => tableau de phrases
      showProposalsModal(data.proposals, activityData.id);
    })
    .catch(error => {
      hideSpinner();
      alert("Erreur : " + error.message);
    });
  }
</script>
