<!-- Code/routes/templates/activity_card.html -->

<div class="activity-container">

  <!-- En-tête (nom, id, bouton Garant) -->
  <div class="activity-header" onclick="toggleDetails('details-{{ item.activity.id }}', this)">
    <span class="toggle-icon" id="icon-{{ item.activity.id }}">▶</span>
    <h2>{{ item.activity.name }}</h2>
  </div>

  <div class="activity-details" id="details-{{ item.activity.id }}" style="display:none;">

    <!-- Description de l'activité -->
    <p>{{ item.activity.description or "" }}</p>

    <!-- Section Garant -->
    <div class="activity-garant" style="margin-bottom:10px;">
      <button onclick="openGarantModal({{ item.activity.id }})">Garant</button>
      <span id="activity-garant-{{ item.activity.id }}" style="margin-left:10px;">
        {% if item.garant %}
          {{ item.garant.name }}
        {% else %}
          Aucun
        {% endif %}
      </span>
    </div>

    <!-- Connexions & Performances (entre Garant et Contraintes) -->
    {# Le partial activity_connections.html attend la variable "item",
       pour afficher item.incoming, item.outgoing, performances, etc. #}
    {% include "activity_connections.html" %}

    <!-- Contraintes -->
    {# activity_constraints.html attend "activity" #}
    {% set activity = item.activity %}
    {% include "activity_constraints.html" %}

    <!-- Tâches -->
    {# activity_tasks.html attend "activity" et parfois "tasks" #}
    {% set tasks = item.tasks %}
    {% set activity = item.activity %}
    {% include "activity_tasks.html" %}

    <!-- Compétences -->
    {# activity_competencies.html attend "activity" #}
    {% set activity = item.activity %}
    {% include "activity_competencies.html" %}

    <!-- 4 colonnes : Savoirs / Savoir-Faire / Aptitudes / Softskills -->
    <div style="display:flex; gap:30px; margin-top:20px;">

      <div style="flex:1;">
        {# activity_savoirs.html attend "activity" #}
        {% set activity = item.activity %}
        {% include "activity_savoirs.html" %}
        <button onclick="proposeSavoirs({{ item.activity.id }})">Proposer Savoirs</button>
      </div>

      <div style="flex:1;">
        {# activity_savoir_faires.html attend "activity" #}
        {% set activity = item.activity %}
        {% include "activity_savoir_faires.html" %}
        <button onclick="proposeSavoirFaires({{ item.activity.id }})">Proposer Savoir-Faire</button>
      </div>

      <div style="flex:1;">
        {# activity_aptitudes.html attend "activity" #}
        {% set activity = item.activity %}
        {% include "activity_aptitudes.html" %}
        <button onclick="proposeAptitudes({{ item.activity.id }})">Proposer Aptitudes</button>
      </div>

      <div style="flex:1;">
        {# activity_softskills.html attend "activity" #}
        {% set activity = item.activity %}
        {% include "activity_softskills.html" %}
      </div>

    </div> <!-- /4 colonnes -->
  </div><!-- /activity-details -->

</div><!-- /activity-container -->
